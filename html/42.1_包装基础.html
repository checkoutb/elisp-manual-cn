<!DOCTYPE html><html><head><link rel="stylesheet" type="text/css" href="elisp.css"><title>42.1 包装基础</title></head><body lang="en" bgcolor="#FFFFFF" text="#000000" link="#0000FF" vlink="#800080" alink="#FF0000"><h2 class="section">42.1 包装基础</h2>
<div class="nav-panel"><p>Next: <a href="42.2_简单包.html">简单包</a>, Previous: <a href="42_准备分发的Lisp代码.html">准备分发的Lisp代码</a>, Up: <a href="42_准备分发的Lisp代码.html">准备分发的Lisp代码.</a> &nbsp; [<a href="00_content.htm" title="Table of contents" rel="contents">Contents</a>]</p></div></body></html><hr/><p>包可以是简单包，也可以是多文件包。一个简单的包以单个 Emacs Lisp 文件的形式存储在包存档中，而多文件包则以 tar 文件的形式存储（包含多个 Lisp 文件，可能还有非 Lisp 文件，例如手册）。
</p>
<p>平时使用中，简单包和多文件包的区别相对不重要；  Package Menu 界面不区分它们。但是，创建它们的过程有所不同，如以下部分所述。
</p>
<p>每个包（无论是简单的还是多文件的）都有一定的属性：
</p>
<div class="lisp">
<pre class="lisp">Name
</pre></div>
<p>一个简短的词（例如，’auctex’）。这通常也是程序中使用的符号前缀（参见 Emacs Lisp 编码约定）。
</p><div class="lisp">
<pre class="lisp">Version
</pre></div>
<p>版本号，采用函数version-to-list 可以理解的形式（例如，’11.86’）。软件包的每次发布都应伴随版本号的增加，以便用户查询软件包存档时将其识别为升级。
</p><div class="lisp">
<pre class="lisp">Brief description
</pre></div>
<p>当包在包菜单中列出时显示。它应该占一行，最好是 36 个字符或更少。
</p><div class="lisp">
<pre class="lisp">Long description
</pre></div>
<p>这显示在由 Ch P (describe-package) 创建的缓冲区中，遵循包的简要描述和安装状态。它通常跨越多行，并且应该完整地描述包的功能以及安装后如何开始使用它。
</p><div class="lisp">
<pre class="lisp">Dependencies
</pre></div>
<p>此包所依赖的其他包的列表（可能包括可接受的最低版本号）。该列表可能为空，这意味着此包没有依赖项。否则，安装这个包也会自动递归地安装它的依赖；  如果找不到任何依赖项，则无法安装该软件包。
</p>
<p>通过命令 package-install-file 或通过 Package Menu 安装包，会在 package-user-dir 的名为 name-version 的子目录中创建一个子目录，其中 name 是包的名称，版本是其版本（例如，~/. emacs.d/elpa/auctex-11.86/）。我们称之为包的内容目录。它是 Emacs 放置包内容的地方（简单包的单个 Lisp 文件，或从多文件包中提取的文件）。
</p>
<p>然后 Emacs 在内容目录中的每个 Lisp 文件中搜索自动加载魔术注释（参见 Autoload）。这些自动加载定义保存到内容目录中名为 name-autoloads.el 的文件中。它们通常用于自动加载包中定义的主要用户命令，但它们也可以执行其他任务，例如向 auto-mode-alist 添加元素（请参阅 Emacs 如何选择主要模式）。请注意，包通常不会自动加载其中定义的每个函数和变量——只有通常调用的少数命令才能开始使用包。Emacs 然后对包中的每个 Lisp 文件进行字节编译。
</p>
<p>安装后，已安装的包被加载：Emacs 将包的内容目录添加到 load-path，并评估 name-autoloads.el 中的自动加载定义。
</p>
<p>每当 Emacs 启动时，它会自动调用函数 package-activate-all 以使已安装的包可用于当前会话。这是在加载早期初始化文件之后但在加载常规初始化文件之前完成的（请参阅摘要：启动时的操作序列）。如果在 early init 文件中将用户选项 package-enable-at-startup 设置为 nil，则不会自动使包可用。
</p>
<div class="lisp">
<pre class="lisp">Function: package-activate-all ¶
</pre></div>
<p>此功能使包可用于当前会话。用户选项 package-load-list 指定哪些包可用；  默认情况下，所有已安装的软件包都可用。请参阅 GNU Emacs 手册中的软件包安装。
</p>
<p>在大多数情况下，您不需要调用 package-activate-all，因为这是在启动期间自动完成的。只需确保将任何应该在 package-activate-all 之前运行的代码放在早期的 init 文件中，并将任何应该在它之后运行的代码放在主 init 文件中（参见 GNU Emacs 手册中的 Init 文件）。
</p>
<div class="lisp">
<pre class="lisp">Command: package-initialize &amp;optional no-activate ¶
</pre></div>
<p>该函数初始化 Emacs 内部记录安装了哪些包，然后调用 package-activate-all。
</p>
<p>可选参数 no-activate，如果非 nil，会导致 Emacs 更新其已安装包的记录，但实际上并不使它们可用。
</p>
<hr/>

<div class="nav-panel"><p>Next: <a href="42.2_简单包.html">简单包</a>, Previous: <a href="42_准备分发的Lisp代码.html">准备分发的Lisp代码</a>, Up: <a href="42_准备分发的Lisp代码.html">准备分发的Lisp代码.</a> &nbsp; [<a href="00_content.htm" title="Table of contents" rel="contents">Contents</a>]</p></div></body></html>